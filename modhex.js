/* Nearly-any-keymap to modhex decoder
Copyright (c) 2009 Daniel Holth <dholth@fastmail.fm>
MIT license. */

ModHex = {
	modhex : 'cbdefghijklnrtuv',
	hex : '0123456789abcdef',
	// Return an Array() of all possible otp->modhex interpretations
	otpToModHex : function(otp, digits) {
		var i;
		var j;
		var characters;
		var intersect = function(item) {
      if(this.indexOf) {
				return this.indexOf(item) >= 0;
      } else { // seriousy ie? impl from mootools.
        var len = this.length;
        for (var i = 0; i < len; i++) {
          if (this[i] === item) return true;
        }
        return false;
      }
		};
		var unique = function(x) {
			if(this.hasOwnProperty(x)) {
				return false;
			} else {
				this[x] = true;
				return true;
			}
		};
		if (typeof (digits) == 'undefined') {
			digits = this.modhex;
		}
		characters = this._filter(unique, otp.split(''), {});
		var possible = [];
		var temp;
		for (i = 0; i < characters.length; i++) {
			temp = this._keymaps[1][characters[i]];
			if (typeof (temp) == 'undefined') {
				return [];
			}
			possible.push(temp);
		}
		var result = possible[0];
		for (i = 0; (i < possible.length) && result.length; i++) {
			result = this._filter(intersect, result, possible[i]);
		}
		var decoded = [];
		for (i = 0; i < result.length; i++) {
			var keymap = this._keymaps[0][result[i]];
			var item = "";
			for (j = 0; j < otp.length; j++) {
				var index = keymap.indexOf(otp[j]);
				var digit = digits[index];
				item = item + digit;
			}
			decoded.push(item);
		}
		decoded = this._filter(unique, decoded, {});
		return decoded;
	},

	// from MochiKit.Base
	_filter : function(fn, lst, self) {
		var rval = [];
		if (typeof (Array.prototype.filter) == 'function') {
			// Mozilla fast-path
			return Array.prototype.filter.call(lst, fn, self);
		} else if (typeof (self) == 'undefined' || self === null) {
			for ( var i = 0; i < lst.length; i++) {
				var o = lst[i];
				if (fn(o)) {
					rval.push(o);
				}
			}
		} else {
			for ( var i = 0; i < lst.length; i++) {
				o = lst[i];
				if (fn.call(self, o)) {
					rval.push(o);
				}
			}
		}	
		return rval;
	},

  _keymaps:[[",yuéebfcstnxg.vi", "cbdefghijklnrtuv", "cbdefghijklnrtuṣ", "cbdefghıjklnrtuv", "cbdefghıíklnrtuv", "cbdefghıĭklnrtuv", "cbdešghijklnrtuv", "cbsftdhuneikpglv", "cbɗefghijklnrtuv", "cžsrtmpuneišldjv", "gwcbdthoeaznyusv", "jka.oumtdsrqhxlb", "jka.oumtdsrĝhĉlb", "jxe.iuhcdrnbpygk", "jxe.uidchtnbpygk", "jxeñuidcrtnbpygk", "jxeöuidchtnbpygk", "vçexautnkmlziorc", "vçeğaütnkmlzıorc", "xizqaehutdcn.os,", "xkipe,cdtsr'oèv.", "¯¦É¿¸À̀¨¾Á¼¶ºÅÃ±", "äzaleosgnrtbcwhp", "čñďéëŕúíüôľňřťůç", "ŋbdefghijklnrtuv", "ŋbdefghiƒklnrtuv", "ψβδεφγηιξκλνρτθω", "жбдефгңийклнртув", "йще.уидцхтнбпыгк", "сивуапршолдткегм", "сиқуапршолдткегм", "сівуапршолдткегм", "цбдефгхийклнртув", "цбдефгхийклнртуж", "цбдефгхијклнртув", "цбдефгхійклнртуж", "цбдефґгійклнртув", "ъфаеожгстнвхишкэ", "ёмбуөахшролижэгс", "գբդէֆքհիճկլնրտըվ", "գպտէֆկհիճքլնրդըւ", "չզգբեանկիտհլսմւյ", "ցբդեֆգհիյկլնռտւվ", "ցբդեֆգհիյկլնրտւվ", "քբդէֆգհիճկլնրտըվ", "בנגקכעיןחלךמראוה", "ؤﻻيثبلاهتنمىقفعر", "جبدەفگهحژکلنرتئڤ", "زذیثبلاهتنمدقفعر", "چبدعفگحیجکلنرتءط", "چبدعفگھیجکلنرتءط", "ےشرھنلہباکیغدٹتس", "ܤܒܕܖܔܓܗܥܛܟܠܢܪܬܜܫ", "ܤܧܝܖܒܠܐܗܬܢܡ܀ܩܦܥܪ", "ޗބދެފގހިޖކލނރތުވ", "ߗߓߘߍߝߜߤߌߖߞߟߣߙߕߎߢ", "चबडेङगहिजकलनरटुव", "चबदेटगहिजकलनरतुड", "छबदेउगहिजकलनरतुव", "मव्ािुपगरकतलीूहन", "চবডীতগহিজকলনরটুআ", "মব্ািুপগরকতলীূহন", "েনিডব্াহকতদসপটজর", "ਚਬ੍ਾਿੁਹਗਜਕਲਨੀੂਦਵ", "ਮਵ੍ਾਿੁਪਗਰਕਤਲੀੂਹਨ", "મવ્ાિુપગરકતલીૂહન", "ମଵ୍ାିୁପଗରକତଲୀୂହନ", "உெனநகபாைதமடஔசவரஎ", "మవ్ాిుపగరకతలీూహన", "ಮವ್ಾಿುಪಗರಕತಲೀೂಹನ", "ചബദെഫഗഹിജകലനരതുവ", "മവ്ാിുപഗരകതലീൂഹന", "චබදඑෆගහඉජකලනරතඋව", "ลิงยกัีมานเคอรดห", "แิกำดเ้ร่าสืพะีอ", "ແຶກຳດເ້ຣ່າສືພະີອ", "ཀཔདེབངམི་གལནརཏུཁ", "འརདགནཔཕོབམཙལངིེཡ", "မဗ္ာိုပဂရကတလီူဟန", "სივუაპრშოლდტკეგმ", "ყჟაუეოდნმსრზძჭთღ", "ცბდეფგჰიჯკლნრტუვ", "ቸበደeፈገሀiጀከለነረተuሸ", "ᏓᎨᏗᎡᎩᎦᎯᎢᏚᎸᎵᎾᏛᏔᎤᎥ", "ᖃᑕᖁᕿᑯᑐᓱᓂᒧᓄᓗᓴᑭᑎᒥᑲ", "ᚉᚁᚇᚓᚃᚌᚆᚔᚗᚖᚂᚅᚏᚈᚒᚍ", "ចបដេថងហិ្កលនរតុវ", "ⵛⴱⴷⴻⴼⴳⵀⵉⵊⴽⵍⵏⵔⵜⵓⵖ", "ソコシイハキクニマノリミスカナヒ"], {"က": [78], "ច": [86], "ค": [73], "ඉ": [72], "ᚏ": [85], "တ": [78], "ด": [73, 74], "ગ": [65], "ਜ": [63], "ড": [60, 62], "ң": [27], "ؤ": [46], "द": [57, 58], "న": [68], "カ": [88], "ܪ": [52, 53], "ਬ": [63], "گ": [49, 50, 47], "മ": [71], "ူ": [78], "ଲ": [66], "ش": [51], "и": [32, 33, 34, 37, 38, 27, 28, 29, 30], "ν": [26], "ാ": [71], "ু": [60, 61], "ୂ": [66], "ل": [48, 49, 50, 51, 46, 47], "ш": [38, 31, 37, 30, 29], "ニ": [88], "ߕ": [55], "י": [45], "ј": [34], "მ": [80, 79], "ز": [48], "ë": [23], "p": [16, 20, 22, 7, 9, 13, 14, 15], "ి": [68], "ེ": [76, 77], "վ": [42, 43, 44, 39], "আ": [60], "ފ": [54], "ܕ": [52], "ດ": [75], "ਗ": [64, 63], "ရ": [78], "រ": [86], "ड": [56, 57], "Ꭲ": [83], "ܥ": [52, 53], "ڤ": [47], "দ": [62], "z": [17, 10, 19, 18, 22], "ನ": [69], "ު": [54], "د": [48, 49, 50, 51, 47], "ı": [18, 3, 4, 5], "г": [32, 33, 34, 35, 36, 37, 38, 27, 28, 29, 30, 31], "β": [26], "ഹ": [70, 71], "ु": [56, 57, 58, 59], "À": [21], "у": [32, 33, 34, 35, 36, 38, 27, 28, 29, 30, 31], "ट": [56, 57], "ⵉ": [87], "്": [71], "୍": [66], "ა": [80, 79], "ཕ": [77], "ɗ": [8], "מ": [45], "š": [9, 6], "რ": [80, 81, 79], "k": [1, 2, 3, 4, 5, 6, 7, 8, 11, 12, 13, 14, 15, 16, 17, 18, 20, 24, 25], "ჰ": [81], "չ": [41], "ᖃ": [84], "ᚅ": [85], "ត": [86], "ܔ": [52], "პ": [79], "ង": [86], "ܤ": [52, 53], "а": [38, 31, 37, 30, 29], "ന": [70, 71], "ت": [48, 49, 50, 51, 46, 47], "మ": [68], "±": [21], "र": [56, 57, 58, 59], "ਲ": [64, 63], "ີ": [75], "η": [26], "ಹ": [69], "ε": [26], "غ": [51], "ิ": [73, 74], "Á": [21], "ी": [59], "ੂ": [64, 63], "ང": [76, 77], "ي": [46], "્": [65], "ᑎ": [84], "ბ": [81], "ە": [47], "པ": [76, 77], "Ꮧ": [83], "ߟ": [55], "ä": [22], "ს": [80, 79], "f": [0, 1, 2, 3, 4, 5, 7, 8, 24, 25], "ө": [38], "ը": [40, 44, 39], "ñ": [23, 15], "ུ": [76], "v": [0, 1, 3, 4, 5, 6, 7, 8, 9, 10, 17, 18, 20, 24, 25], "ľ": [23], "ກ": [75], "ބ": [54], "р": [32, 33, 34, 35, 36, 38, 27, 29, 30, 31], "ந": [67], "ប": [86], "ଗ": [66], "छ": [58], "ܟ": [52], "ล": [73], "¦": [21], "ສ": [75], "ಮ": [69], "র": [60, 61, 62], "ⴳ": [87], "લ": [65], "ี": [73, 74], "¶": [21], "హ": [68], "ಾ": [69], "ী": [60, 61], "ૂ": [65], "م": [48, 46], "щ": [28], "ŋ": [24, 25], "੍": [64, 63], "ཏ": [76], "ⵓ": [87], "ზ": [80], "த": [67], "a": [17, 18, 19, 22, 10, 11, 12], "գ": [39, 40, 41, 42, 43, 44], "ߤ": [55], "ღ": [80], "ר": [45], "q": [19, 11], "ճ": [40, 44, 39], "ö": [16], "ሀ": [82], "ᚃ": [85], "ጀ": [82], "ح": [49, 47], "ც": [81], "ᚓ": [85], "ച": [70], "လ": [78], "Ꭱ": [83], "ຣ": [75], "త": [68], "ب": [48, 49, 50, 51, 46, 47], "പ": [71], ",": [0, 19, 20], "ਰ": [64], "ຳ": [75], "ल": [56, 57, 58, 59], "д": [32, 33, 34, 35, 36, 27, 28, 29, 30, 31], "シ": [88], "ಿ": [69], "ρ": [26], "ੀ": [64, 63], "ू": [59], "ф": [32, 33, 34, 35, 36, 37, 27], "่": [74], "ⵊ": [87], "্": [61, 62], "й": [32, 33, 35, 36, 27, 28], "ו": [45], "თ": [80], "ߙ": [55], "በ": [82], "ç": [17, 18, 23], "l": [1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 12, 17, 18, 22, 24, 25], "ተ": [82], "պ": [40], "ძ": [80], "с": [38, 31, 37, 30, 29], "ᚈ": [85], "č": [23], "ގ": [54], "ነ": [82], "ƒ": [25], "ക": [70, 71], "ဗ": [78], "ژ": [47], "ක": [72], "ĝ": [12], "ร": [73, 74], "ತ": [69], "'": [20], "Ꭶ": [83], "ܩ": [53], "ĭ": [5], "ર": [65], "س": [51], "ল": [60, 61], "വ": [70, 71], "¼": [21], "п": [28, 29, 30, 31], "ୁ": [66], "ી": [65], "ূ": [61], "ᓄ": [84], "φ": [26], "່": [75], "्": [59], "ߎ": [55], "ཙ": [77], "ך": [45], "ნ": [80, 81], "ߞ": [55], "ṣ": [2], "ե": [41, 42, 43], "g": [0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 13, 14, 15, 16, 22, 24, 25], "ᑯ": [84], "ደ": [82], "յ": [41, 42, 43], "ᓴ": [84], "w": [10, 22], "ü": [18, 23], "̀": [21], "ރ": [54], "ဂ": [78], "ᚉ": [85], "ន": [86], "ಕ": [69], "গ": [60, 61], "ज": [56, 57, 58], "พ": [74], "ᒥ": [84], "ത": [70, 71], "ਦ": [63], "ک": [49, 50, 51, 47], "ప": [68], "キ": [88], "ब": [56, 57, 58], "ද": [72], "ĉ": [12], "в": [32, 34, 36, 37, 27, 29, 31], "ವ": [69], "λ": [26], "к": [32, 33, 34, 35, 36, 37, 27, 28, 29, 30, 31], "ソ": [88], "ુ": [65], "ୀ": [66], "ដ": [86], "ে": [62], "້": [75], "ъ": [37], "ߓ": [55], "ⵔ": [87], "མ": [76, 77], "Ꮫ": [83], "ო": [80, 79], "ן": [45], "ߣ": [55], "b": [0, 1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 22, 24, 25], "դ": [40, 42, 43, 44, 39], "í": [4, 23], "r": [1, 2, 3, 4, 5, 6, 8, 9, 11, 12, 13, 15, 17, 18, 20, 22, 24, 25], "մ": [41], "ᚔ": [85], "ہ": [51], "ք": [40, 44, 39], "ވ": [54], "ܓ": [52], "т": [32, 33, 34, 35, 36, 37, 27, 28, 29, 30, 31], "క": [68], "ग": [56, 57, 58, 59], "น": [73], "জ": [60, 62], "ພ": [75], "ᖁ": [84], "ި": [54], "ಪ": [69], "ိ": [78], "ব": [60, 61, 62], "ர": [67], "е": [32, 33, 34, 35, 36, 37, 27, 28, 29, 30, 31], "ع": [48, 49, 50, 46], "ി": [70, 71], "ھ": [50, 51], "ੁ": [64, 63], "х": [32, 33, 34, 35, 37, 38, 28], "හ": [72], "े": [56, 57, 58], "ى": [46], "ⵏ": [87], "ན": [76, 77], "გ": [81, 79], "ᑕ": [84], "ה": [45], "ߘ": [55], "ལ": [76, 77], "ტ": [81, 79], "m": [9, 18, 11, 12, 17], "կ": [39, 40, 41, 42, 43, 44], "ٹ": [51], "տ": [39, 40, 41, 42, 43, 44], "ց": [42, 43], "ᚇ": [85], "ލ": [54], "එ": [72], "ܒ": [52, 53], "க": [67], "ᚗ": [85], "қ": [30], "ܢ": [52, 53], "Ꭵ": [83], "ਤ": [64], "ദ": [70], "ପ": [66], "ج": [49, 50, 47], "म": [59], "න": [72], "ర": [68], "コ": [88], "வ": [67], "ື": [75], "হ": [60, 61, 62], "િ": [65], "ा": [59], "ీ": [68], "Ã": [21], "ག": [76, 77], "ط": [49, 50], "െ": [70], "ߍ": [55], "ב": [45], "ᑐ": [84], "დ": [80, 81, 79], "ⵖ": [87], "ߝ": [55], "უ": [80, 81, 79], "ར": [76, 77], "զ": [41], "h": [1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 16, 19, 22, 24, 25], "θ": [26], "ི": [76, 77], "ն": [39, 40, 41, 42, 43, 44], "x": [0, 11, 13, 14, 15, 16, 17, 19, 20], "ž": [9], "ނ": [54], "ง": [73], "ֆ": [40, 42, 43, 44, 39], "उ": [58], "ჭ": [80], "ᚌ": [85], "କ": [66], "ङ": [56], "ச": [67], "ܝ": [53], "ત": [65], "ا": [48, 51, 46], "¨": [21], "ப": [67], "ম": [61], "ⴱ": [87], "ರ": [69], "ଵ": [66], "ื": [74], "බ": [72], "ह": [56, 57, 58, 59], "¸": [21], "л": [32, 33, 34, 35, 36, 38, 27, 29, 30, 31], "κ": [26], "ਿ": [64, 63], "া": [61, 62], "ു": [70, 71], "ೀ": [69], "ه": [48, 46, 47], "ෆ": [72], "ы": [28], "ی": [48, 49, 50, 51], "្": [86], "ř": [23], "ი": [81, 79], "Ꮪ": [83], "Ꮎ": [83], "ա": [41], "c": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 13, 14, 15, 16, 17, 18, 19, 20, 22], "ߢ": [55], "è": [20], "ன": [67], "s": [0, 7, 9, 10, 11, 12, 19, 20, 22], "ਨ": [64, 63], "ހ": [54], "උ": [72], "ᚍ": [85], "ീ": [71], "ာ": [78], "ґ": [36], "ક": [65], "¯": [21], "ޗ": [54], "ਚ": [63], "ܜ": [52], "ட": [67], "ย": [73], "ତ": [66], "ذ": [48], "न": [56, 57, 58, 59], "ਪ": [64], "ອ": [75], "ܬ": [52, 53], "Ꭿ": [83], ".": [0, 19, 20, 28, 11, 12, 13, 14], "ര": [70, 71], "า": [73, 74], "વ": [65], "ិ": [86], "ж": [38, 33, 27, 37, 35], "ス": [88], "ර": [72], "ು": [69], "ⵀ": [87], "ق": [48, 46], "ц": [32, 33, 34, 35, 36, 28], "É": [21], "ň": [23], "ߗ": [55], "і": [35, 36, 31], "კ": [81, 79], "כ": [45], "ξ": [26], "é": [0, 23], "n": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 13, 14, 15, 16, 17, 18, 19, 22, 24, 25], "ᓱ": [84], "հ": [39, 40, 41, 42, 43, 44], "შ": [79], "ོ": [77], "ր": [40, 43, 44, 39], "ᚂ": [85], "ތ": [54], "ᚒ": [85], "ਕ": [64, 63], "ஔ": [67], "ܗ": [52, 53], "မ": [78], "វ": [86], "ච": [72], "Ꭴ": [83], "ܧ": [53], "ন": [60, 61, 62], "ഫ": [70], "પ": [65], "อ": [73, 74], "ެ": [54], "б": [32, 33, 34, 35, 36, 38, 27, 28], "າ": [75], "ਵ": [64, 63], "δ": [26], "္": [78], "স": [62], "ⴻ": [87], "ି": [66], "¾": [21], "ు": [68], "ව": [72], "τ": [26], "ߌ": [55], "ノ": [88], "ё": [38], "א": [45], "ے": [51], "Ꮤ": [83], "ⵛ": [87], "ߜ": [55], "マ": [88], "נ": [45], "i": [0, 1, 2, 6, 7, 8, 9, 13, 14, 15, 16, 17, 82, 19, 20, 24, 25], "ի": [39, 40, 41, 42, 43, 44], "ా": [68], "ำ": [74], "y": [0, 16, 10, 13, 14, 15], "உ": [67], "ለ": [82], "ক": [60, 61, 62], "န": [78], "ಗ": [69], "ܖ": [52, 53], "च": [56, 57], "ر": [48, 49, 50, 51, 46, 47], "ᒧ": [84], "ܦ": [53], "Ꭹ": [83], "ረ": [82], "प": [59], "ත": [72], "ク": [88], "ମ": [66], "ะ": [74], "ല": [70, 71], "ჟ": [80], "ι": [26], "ሸ": [82], "వ": [68], "ල": [72], "м": [38, 29, 30, 31], "¿": [21], "ା": [66], "េ": [86], "เ": [73, 74], "ൂ": [71], "ω": [26], "ハ": [88], "چ": [49, 50], "ᓗ": [84], "བ": [76, 77], "ミ": [88], "d": [1, 2, 3, 4, 5, 6, 7, 9, 10, 11, 12, 13, 14, 15, 16, 19, 20, 24, 25], "բ": [41, 42, 43, 44, 39], "ყ": [80], "้": [74], "ெ": [67], "t": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 14, 15, 16, 17, 18, 19, 20, 22, 24, 25], "ቸ": [82], "ﻻ": [46], "ف": [48, 49, 50, 46, 47], "ւ": [40, 41, 42, 43], "ކ": [54], "எ": [67], "ೂ": [69], "क": [56, 57, 58, 59], "ჯ": [81], "గ": [68], "ޖ": [54], "চ": [60], "ဟ": [78], "ܡ": [53], "ජ": [72], "イ": [88], "ન": [65], "ث": [48, 46], "প": [61, 62], "ု": [78], "ம": [67], "ະ": [75], "व": [56, 58, 59], "ψ": [26], "ହ": [66], "ⴽ": [87], "ா": [67], "ཁ": [76], "ເ": [75], "э": [37, 38], "ⵍ": [87], "ད": [76, 77], "ג": [45], "ŕ": [23], "ე": [80, 81, 79], "ߖ": [55], "ཡ": [77], "ע": [45], "ť": [23], "ფ": [81], "o": [17, 18, 19, 20, 22, 10, 11, 12], "ヒ": [88], "ô": [23], "ս": [41], "ᚁ": [85], "܀": [53], "ର": [66], "ส": [74], "ገ": [82], "ދ": [54], "ܐ": [53], "ល": [86], "ီ": [78], "ജ": [70], "ট": [60, 62], "ܠ": [52, 53], "त": [57, 58, 59], "ئ": [47], "ନ": [66], "ബ": [70], "ਮ": [64], "γ": [26], "ల": [68], "હ": [65], "ុ": [86], "ⴼ": [87], "ি": [60, 61, 62], "ਾ": [64, 63], "ແ": [75], "ཀ": [76], "ూ": [68], "Å": [21], "ن": [48, 49, 50, 51, 46, 47], "ፈ": [82], "್": [69], "Ꮣ": [83], "ვ": [81, 79], "ח": [45], "ⵜ": [87], "འ": [77], "ק": [45], "j": [1, 2, 3, 6, 8, 9, 11, 12, 13, 14, 15, 16, 24], "լ": [39, 40, 41, 42, 43, 44], "ᑲ": [84], "о": [38, 31, 37, 30, 29], "ռ": [42], "ก": [73, 74], "ក": [86], "ء": [49, 50], "ᚆ": [85], "་": [76], "ď": [23], "ថ": [86], "ပ": [78], "ഗ": [70, 71], "ᚖ": [85], "ܛ": [52], "ග": [72], "ğ": [18], "ม": [73], "ហ": [86], "ত": [60, 61, 62], "Ꭸ": [83], "ܫ": [52], "મ": [65], "ั": [73], "ಲ": [69], "ⴷ": [87], "ຶ": [75], "ਹ": [64, 63], "Ꮈ": [83], "º": [21], "н": [32, 33, 34, 35, 36, 37, 27, 28], "ि": [56, 57, 58, 59], "ા": [65], "แ": [74], "ᓂ": [84], "ை": [67], "ナ": [88], "్": [68], "ლ": [81, 79], "ל": [45], "e": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 13, 14, 15, 16, 17, 18, 19, 20, 22, 24, 25, 82], "է": [40, 44, 39], "リ": [88], "ᑭ": [84], "ů": [23], "u": [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 82, 19, 24, 25], "ᕿ": [84], "ከ": [82], "ú": [23], "ห": [73], "Ꮅ": [83]}]
};
